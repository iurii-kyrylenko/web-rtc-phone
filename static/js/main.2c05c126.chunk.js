(this["webpackJsonpkaios-web-phone"]=this["webpackJsonpkaios-web-phone"]||[]).push([[0],[,,,,function(e,t,n){e.exports={inputForm:"InputForm_inputForm__10-Mc",label:"InputForm_label__ffqu2",input:"InputForm_input__18_QU",code:"InputForm_code__2b8Cr"}},function(e,t,n){e.exports={softKeys:"Softkeys_softKeys__33jJi",left:"Softkeys_left__3jywJ",right:"Softkeys_right__2gKj5",center:"Softkeys_center__2rLlj"}},function(e,t,n){e.exports={info:"Info_info__2d-ke",prompt:"Info_prompt__1PADz",message:"Info_message__2Mj9L"}},,function(e,t,n){e.exports={header:"Header_header__1VCKf",title:"Header_title__3SH2Q"}},,,,,,,function(e,t,n){},,function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=17},function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(9),o=n.n(c),s=(n(15),n(2)),i=n(3),u=n(8),l=n.n(u),f=n(0),b=function(e){var t=e.title;return Object(f.jsx)("header",{className:l.a.header,children:Object(f.jsx)("span",{className:l.a.title,children:t})})},j={debug:3},d="SoftLeft",m="SoftRight",p=n(4),O=n.n(p),h=r.a.forwardRef((function(e,t){var n=e.label,r=e.onSubmit,c=e.onSoftLeft,o=e.isActive,s=e.code,u=Object(a.useState)(""),l=Object(i.a)(u,2),b=l[0],j=l[1],p=Object(f.jsx)("input",{className:O.a.input,ref:t,type:"text",value:b,onChange:function(e){j(e.target.value)},onKeyDown:function(e){switch(e.key){case m:return void j("");case d:return void(c&&c());default:return}}}),h=Object(f.jsx)("span",{className:O.a.code,children:s});return Object(f.jsx)("form",{className:O.a.inputForm,onSubmit:function(e){var t=b.trim();t&&r(t),e.preventDefault()},children:Object(f.jsxs)("label",{children:[Object(f.jsxs)("span",{className:O.a.label,children:[n,":"]}),o?p:h]})})})),v=n(6),g=n.n(v),_=function(e){var t=e.text,n=e.isMessage?g.a.message:g.a.prompt;return Object(f.jsx)("div",{className:g.a.info,children:Object(f.jsx)("span",{className:n,children:t})})},y=r.a.forwardRef((function(e,t){var n=e.onSubmit;return Object(f.jsx)("form",{onSubmit:function(e){n(),e.preventDefault()},style:{width:0,height:0},children:Object(f.jsx)("input",{ref:t,type:"text",style:{opacity:0}})})})),S=n(5),x=n.n(S),E=function(e,t){return function(){var n=new KeyboardEvent("keydown",{key:e,view:window,bubbles:!0,cancelable:!0});t&&t.current.dispatchEvent(n)}},w=function(e){return function(){var t=new KeyboardEvent("submit",{view:window,bubbles:!0,cancelable:!0});e.current.closest("form").dispatchEvent(t)}},C=function(e){var t=e.left,n=e.center,a=e.right,r=e.target;return Object(f.jsxs)("div",{className:x.a.softKeys,children:[Object(f.jsx)("label",{className:x.a.left,onClick:E(d,r),children:t}),Object(f.jsx)("label",{className:x.a.center,onClick:w(r),children:n}),Object(f.jsx)("label",{className:x.a.right,onClick:E(m,r),children:a})]})},N=n(10),k=n.n(N),L=null,R=null,A=null,M=!1;var I=function(e,t){switch(t.type){case"LISTEN":return Object(s.a)(Object(s.a)({},e),{},{me:t.data,status:"Listening",message:""});case"CONNECT":return Object(s.a)(Object(s.a)({},e),{},{contact:t.data,status:"Conversation",message:""});case"REGISTER":return Object(s.a)(Object(s.a)({},e),{},{me:"",contact:"",status:"Registration"});case"MESSAGE":return Object(s.a)(Object(s.a)({},e),{},{message:t.data});default:return}},T={Registration:r.a.createRef(),Listening:r.a.createRef(),Conversation:r.a.createRef()},F=function(e){return{Registration:{left:null,center:"JOIN",right:"Clear"},Listening:{left:"Leave",center:"CALL",right:"Clear"},Conversation:{left:null,center:"LEAVE",right:null}}[e]},G=function(){var e=Object(a.useState)(function(){var e=new Audio;return e.autoplay=!0,e}()),t=Object(i.a)(e,1)[0],n=Object(a.useReducer)(I,{status:"Registration",me:"",contact:"",message:""}),r=Object(i.a)(n,2),c=r[0],o=r[1];Object(a.useEffect)((function(){return T[c.status].current.focus()}));var u,l=function(){o({type:"MESSAGE",data:""}),R.destroy()};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(b,{title:c.status}),Object(f.jsx)(h,{ref:T.Registration,label:"Me",onSubmit:function(e){var n,a;o({type:"MESSAGE",data:"Wait, please!"}),n=e,a={open:function(e){o({type:"LISTEN",data:e})},close:function(){t.srcObject=null,o({type:"REGISTER"})},error:function(e){o({type:"MESSAGE",data:e.message})},stream:function(e,n){t.srcObject=e,o({type:"CONNECT",data:n})}},(R=new k.a(n,j)).on("open",(function(e){navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then((function(e){return A=e})).then((function(){return M=!1})).then((function(){return a.open(e)})).catch((function(e){return a(e)}))})),R.on("close",(function(){A&&A.getTracks().forEach((function(e){return e.stop()})),a.close()})),R.on("error",(function(e){clearTimeout(L),a.error(e)})),R.on("call",(function(e){M||(e.answer(A),e.on("stream",(function(t){M=!0;var n=e.peer;a.stream(t,n)})))}))},isActive:"Registration"===c.status,code:c.me}),Object(f.jsx)(h,{ref:T.Listening,label:"Contact",onSubmit:function(e){e!==c.me?(o({type:"MESSAGE",data:"Wait, please!"}),function(e,t){var n=R.call(e,A);L=setTimeout((function(){return!n.open&&t.timeout()}),1e4),n.on("stream",(function(e){clearTimeout(L),M=!0,t.stream(e)}))}(e,{stream:function(n){t.srcObject=n,o({type:"CONNECT",data:e})},timeout:function(){o({type:"MESSAGE",data:'Contact "'.concat(e,'" is probably busy')})}})):o({type:"MESSAGE",data:"Cannot connect to myself"})},onSoftLeft:l,isActive:"Listening"===c.status,code:c.contact}),Object(f.jsx)(y,{ref:T.Conversation,onSubmit:l}),Object(f.jsx)(_,{text:(u=c.status,{Registration:"Please, input your code.",Listening:"Wait for conversation or connect to your contact.",Conversation:"Talk with contact."}[u])}),Object(f.jsx)(_,{text:c.message,isMessage:!0}),Object(f.jsx)(C,Object(s.a)(Object(s.a)({},F(c.status)),{},{target:T[c.status]}))]})};o.a.render(Object(f.jsx)(G,{}),document.getElementById("root"))}],[[18,1,2]]]);